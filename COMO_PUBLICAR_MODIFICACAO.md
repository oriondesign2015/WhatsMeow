# üöÄ Como Publicar a Modifica√ß√£o do WhatsMeow

## üìã Op√ß√µes Dispon√≠veis

Existem **4 formas principais** de disponibilizar sua modifica√ß√£o:

1. **Fork no GitHub** (Recomendado) ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
2. **Pull Request para o projeto original** ‚≠ê‚≠ê‚≠ê‚≠ê
3. **M√≥dulo Go separado** ‚≠ê‚≠ê‚≠ê
4. **Distribui√ß√£o manual** ‚≠ê‚≠ê

---

## ‚úÖ OP√á√ÉO 1: Fork no GitHub (RECOMENDADO)

Esta √© a forma **mais profissional e f√°cil** de distribuir sua modifica√ß√£o.

### üìù Passo a Passo

#### 1. Criar Fork no GitHub

```bash
# 1. V√° para: https://github.com/tulir/whatsmeow
# 2. Clique em "Fork" (canto superior direito)
# 3. Isso criar√°: https://github.com/SEU-USUARIO/whatsmeow
```

#### 2. Configurar Git Local

```bash
# Inicializar git (se ainda n√£o tiver)
cd "C:\Users\Administrador\Downloads\Original Whatsmeow\whatsmeow-main"
git init

# Adicionar seu fork como remote
git remote add origin https://github.com/SEU-USUARIO/whatsmeow.git

# Configurar usu√°rio
git config user.name "Seu Nome"
git config user.email "seu@email.com"
```

#### 3. Commit das Modifica√ß√µes

```bash
# Adicionar os arquivos modificados
git add store/clientpayload.go

# Adicionar a documenta√ß√£o (opcional mas recomendado)
git add LEIA-ME_MODIFICACAO.txt
git add RESUMO_SOLUCAO.md
git add MODIFICACOES_WHATSMEOW.txt
git add COMO_TESTAR.txt
git add exemplo_uso.go
git add INDICE_ARQUIVOS.txt

# Criar commit
git commit -m "feat: Adicionar configura√ß√£o para desabilitar sincroniza√ß√£o de hist√≥rico

- Adiciona HistorySyncConfig em DeviceProps com limites zerados por padr√£o
- Cria fun√ß√£o SetHistorySyncConfig() para personaliza√ß√£o
- Resolve problema de bloqueio de mensagens novas por sync de hist√≥rico
- Adiciona documenta√ß√£o completa e exemplos de uso"
```

#### 4. Push para GitHub

```bash
# Primeira vez (criar branch main)
git branch -M main
git push -u origin main

# Pr√≥ximas vezes
git push
```

#### 5. Criar uma Release/Tag

```bash
# Criar tag de vers√£o
git tag -a v1.0.0-no-history-sync -m "Vers√£o com hist√≥rico desabilitado por padr√£o"
git push origin v1.0.0-no-history-sync
```

### üéØ Como Outros V√£o Usar Seu Fork

#### M√©todo 1: go.mod com replace

```go
// go.mod do projeto do usu√°rio
module meu-projeto

go 1.21

require (
    go.mau.fi/whatsmeow v0.0.0-20241005000000-000000000000
)

// Substituir pela sua vers√£o
replace go.mau.fi/whatsmeow => github.com/SEU-USUARIO/whatsmeow v1.0.0-no-history-sync
```

#### M√©todo 2: go get direto

```bash
go get github.com/SEU-USUARIO/whatsmeow@v1.0.0-no-history-sync
```

#### M√©todo 3: Importar diretamente

```go
// No c√≥digo Go
import "github.com/SEU-USUARIO/whatsmeow"
```

### üì¢ Divulga√ß√£o

Depois de publicar, voc√™ pode:

1. **Criar um README.md personalizado** explicando as diferen√ßas
2. **Postar no GitHub Discussions** do WhatsMeow original
3. **Compartilhar na comunidade Matrix** do WhatsMeow
4. **Criar uma documenta√ß√£o** no GitHub Pages

---

## ‚úÖ OP√á√ÉO 2: Pull Request para Projeto Original

Se voc√™ quiser que sua modifica√ß√£o seja **integrada ao WhatsMeow oficial**:

### üìù Passo a Passo

#### 1. Fork e Clone (igual Op√ß√£o 1)

```bash
# J√° feito acima
```

#### 2. Criar Branch para a Feature

```bash
git checkout -b feature/disable-history-sync-by-default
```

#### 3. Fazer as Modifica√ß√µes

```bash
# Voc√™ j√° fez! Apenas commit
git add store/clientpayload.go
git commit -m "Add HistorySyncConfig to disable history sync by default"
```

#### 4. Push e Criar Pull Request

```bash
git push -u origin feature/disable-history-sync-by-default

# V√° para: https://github.com/tulir/whatsmeow/pulls
# Clique em "New Pull Request"
# Selecione sua branch: feature/disable-history-sync-by-default
```

#### 5. Escrever Descri√ß√£o do PR

```markdown
## üéØ Objetivo

Adicionar configura√ß√£o para desabilitar sincroniza√ß√£o de hist√≥rico por padr√£o,
resolvendo o problema de bloqueio de mensagens novas ao reconectar ap√≥s 
per√≠odos offline.

## üìù Mudan√ßas

- Adiciona `HistorySyncConfig` em `DeviceProps` com limites zerados (0 dias)
- Cria fun√ß√£o p√∫blica `SetHistorySyncConfig()` para personaliza√ß√£o
- Mant√©m retrocompatibilidade total

## ‚úÖ Benef√≠cios

- Mensagens novas chegam imediatamente, sem bloqueio
- Reduz uso de CPU e mem√≥ria
- Melhora experi√™ncia do usu√°rio
- Configur√°vel via fun√ß√£o p√∫blica

## üß™ Testado

- ‚úÖ Compila√ß√£o sem erros
- ‚úÖ Mensagens novas chegam instantaneamente
- ‚úÖ Sem breaking changes
- ‚úÖ Backward compatible

## üìö Documenta√ß√£o

Documenta√ß√£o completa inclu√≠da nos arquivos:
- MODIFICACOES_WHATSMEOW.txt
- exemplo_uso.go
```

### ‚ö†Ô∏è Considera√ß√µes

**Pr√≥s:**
- ‚úÖ Sua mudan√ßa pode ser integrada oficialmente
- ‚úÖ Todos se beneficiam automaticamente
- ‚úÖ N√£o precisa manter fork separado

**Contras:**
- ‚ö†Ô∏è Pode ser rejeitado pelo maintainer
- ‚ö†Ô∏è Pode demorar para ser revisado/aprovado
- ‚ö†Ô∏è Pode pedir mudan√ßas antes de aceitar

---

## ‚úÖ OP√á√ÉO 3: M√≥dulo Go Wrapper

Criar um m√≥dulo que **envolve** o WhatsMeow com suas modifica√ß√µes.

### üìù Estrutura

```
whatsmeow-no-history/
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ go.sum
‚îú‚îÄ‚îÄ whatsmeow.go (seu wrapper)
‚îî‚îÄ‚îÄ README.md
```

### üíª C√≥digo do Wrapper

```go
// whatsmeow.go
package whatsmeow_no_history

import (
    "go.mau.fi/whatsmeow"
    "go.mau.fi/whatsmeow/store"
    waLog "go.mau.fi/whatsmeow/util/log"
)

// NewClient cria um cliente WhatsMeow com hist√≥rico desabilitado por padr√£o
func NewClient(deviceStore *store.Device, log waLog.Logger) *whatsmeow.Client {
    // Desabilitar hist√≥rico ANTES de criar o cliente
    store.SetHistorySyncConfig(0, 0)
    
    return whatsmeow.NewClient(deviceStore, log)
}

// NewClientWithHistory cria um cliente com hist√≥rico configur√°vel
func NewClientWithHistory(deviceStore *store.Device, log waLog.Logger, fullDays, recentDays uint32) *whatsmeow.Client {
    store.SetHistorySyncConfig(fullDays, recentDays)
    return whatsmeow.NewClient(deviceStore, log)
}
```

### ‚ö†Ô∏è Problema com esta abordagem

Esta op√ß√£o **N√ÉO FUNCIONA** neste caso porque voc√™ precisa modificar o c√≥digo
interno do WhatsMeow (`clientpayload.go`). Um wrapper n√£o consegue fazer isso.

**Esta op√ß√£o s√≥ funcionaria se voc√™ criar um fork completo (Op√ß√£o 1).**

---

## ‚úÖ OP√á√ÉO 4: Distribui√ß√£o Manual / Script de Patch

Criar um **script** que modifica o WhatsMeow instalado.

### üìù Criar Script de Patch

```bash
# patch_whatsmeow.sh (Linux/Mac) ou patch_whatsmeow.ps1 (Windows)
```

#### Windows (PowerShell)

```powershell
# patch_whatsmeow.ps1

$GOPATH = go env GOPATH
$WHATSMEOW_PATH = "$GOPATH\pkg\mod\go.mau.fi\whatsmeow@*\store\clientpayload.go"

Write-Host "üîç Procurando WhatsMeow instalado..."
$files = Get-ChildItem -Path "$GOPATH\pkg\mod\go.mau.fi\" -Recurse -Filter "clientpayload.go" -ErrorAction SilentlyContinue

if ($files.Count -eq 0) {
    Write-Host "‚ùå WhatsMeow n√£o encontrado. Instale primeiro: go get go.mau.fi/whatsmeow"
    exit 1
}

$file = $files[0].FullName
Write-Host "‚úÖ Encontrado: $file"

# Fazer backup
Copy-Item $file "$file.backup"
Write-Host "üíæ Backup criado: $file.backup"

# Aplicar patch
$content = Get-Content $file -Raw

if ($content -match "HistorySyncConfig") {
    Write-Host "‚ö†Ô∏è  Patch j√° aplicado!"
    exit 0
}

# Adicionar configura√ß√£o
$search = "RequireFullSync: proto.Bool\(false\),"
$replace = @"
RequireFullSync: proto.Bool(false),
	HistorySyncConfig: &waCompanionReg.DeviceProps_HistorySyncConfig{
		FullSyncDaysLimit:   proto.Uint32(0),
		RecentSyncDaysLimit: proto.Uint32(0),
	},
"@

$content = $content -replace [regex]::Escape($search), $replace
Set-Content -Path $file -Value $content

Write-Host "‚úÖ Patch aplicado com sucesso!"
Write-Host "üîÑ Execute 'go clean -cache' e recompile seu projeto"
```

#### Linux/Mac (Bash)

```bash
#!/bin/bash
# patch_whatsmeow.sh

GOPATH=$(go env GOPATH)
WHATSMEOW_PATH="$GOPATH/pkg/mod/go.mau.fi/whatsmeow@*/store/clientpayload.go"

echo "üîç Procurando WhatsMeow instalado..."
file=$(find "$GOPATH/pkg/mod/go.mau.fi/" -name "clientpayload.go" 2>/dev/null | head -n 1)

if [ -z "$file" ]; then
    echo "‚ùå WhatsMeow n√£o encontrado. Instale primeiro: go get go.mau.fi/whatsmeow"
    exit 1
fi

echo "‚úÖ Encontrado: $file"

# Fazer backup
cp "$file" "$file.backup"
echo "üíæ Backup criado: $file.backup"

# Verificar se j√° foi aplicado
if grep -q "HistorySyncConfig" "$file"; then
    echo "‚ö†Ô∏è  Patch j√° aplicado!"
    exit 0
fi

# Aplicar patch
sed -i.bak '/RequireFullSync: proto.Bool(false),/a\
	HistorySyncConfig: \&waCompanionReg.DeviceProps_HistorySyncConfig{\
		FullSyncDaysLimit:   proto.Uint32(0),\
		RecentSyncDaysLimit: proto.Uint32(0),\
	},
' "$file"

echo "‚úÖ Patch aplicado com sucesso!"
echo "üîÑ Execute 'go clean -cache' e recompile seu projeto"
```

### üéØ Como Distribuir o Script

1. **Publicar no GitHub** como um reposit√≥rio separado
2. **Instru√ß√µes de uso:**

```bash
# Linux/Mac
curl -O https://raw.githubusercontent.com/SEU-USUARIO/whatsmeow-no-history-patch/main/patch_whatsmeow.sh
chmod +x patch_whatsmeow.sh
./patch_whatsmeow.sh

# Windows
Invoke-WebRequest -Uri "https://raw.githubusercontent.com/SEU-USUARIO/whatsmeow-no-history-patch/main/patch_whatsmeow.ps1" -OutFile "patch_whatsmeow.ps1"
powershell -ExecutionPolicy Bypass -File .\patch_whatsmeow.ps1
```

---

## üìä Compara√ß√£o das Op√ß√µes

| Op√ß√£o | Facilidade | Manuten√ß√£o | Alcance | Recomendado |
|-------|------------|------------|---------|-------------|
| **1. Fork GitHub** | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚úÖ **SIM** |
| **2. Pull Request** | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚úÖ **SIM** |
| **3. Wrapper** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | ‚ùå N√£o funciona |
| **4. Script Patch** | ‚≠ê‚≠ê | ‚≠ê | ‚≠ê‚≠ê | ‚ö†Ô∏è Hackish |

---

## üéØ Recomenda√ß√£o Final

### Para Disponibilizar Rapidamente: **OP√á√ÉO 1 (Fork)**

1. Crie um fork no GitHub
2. Publique suas modifica√ß√µes
3. Crie releases/tags
4. Compartilhe na comunidade

### Para Beneficiar Todos: **OP√á√ÉO 2 (Pull Request)**

1. Crie o PR para o projeto original
2. Enquanto aguarda aprova√ß√£o, mantenha seu fork (Op√ß√£o 1)
3. Se aprovado, todos se beneficiam automaticamente

### Estrat√©gia H√≠brida (RECOMENDADO) ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê

```
1. Criar fork no GitHub (Op√ß√£o 1)
   ‚îî‚îÄ> Dispon√≠vel imediatamente para uso

2. Criar Pull Request (Op√ß√£o 2)
   ‚îî‚îÄ> Tentativa de integra√ß√£o oficial

3. Enquanto aguarda PR:
   ‚îî‚îÄ> Manter fork atualizado
   ‚îî‚îÄ> Divulgar na comunidade
```

---

## üìù Exemplo Completo: Fork no GitHub

### 1. Criar Fork

```bash
# No navegador:
# https://github.com/tulir/whatsmeow ‚Üí Fork
```

### 2. Configurar Local

```bash
cd "C:\Users\Administrador\Downloads\Original Whatsmeow\whatsmeow-main"

# Inicializar git
git init

# Adicionar remote
git remote add origin https://github.com/SEU-USUARIO/whatsmeow.git

# Configurar
git config user.name "Seu Nome"
git config user.email "seu@email.com"

# Adicionar arquivos
git add .

# Commit
git commit -m "feat: Disable history sync by default to prevent message blocking

- Add HistorySyncConfig with zero limits in DeviceProps
- Add SetHistorySyncConfig() function for customization
- Add comprehensive documentation
- Add usage examples

This change fixes the issue where new messages are blocked while
syncing historical messages after being offline for days."

# Push
git branch -M main
git push -u origin main

# Criar tag
git tag -a v1.0.0 -m "Version 1.0.0 - History sync disabled by default"
git push origin v1.0.0
```

### 3. Atualizar README.md

```markdown
# WhatsMeow - No History Sync Fork

Fork do WhatsMeow com sincroniza√ß√£o de hist√≥rico desabilitada por padr√£o.

## üéØ Diferen√ßa do Original

- **Hist√≥rico desabilitado** por padr√£o (0 dias)
- **Mensagens novas** chegam imediatamente
- **Sem bloqueio** ao reconectar
- **Configur√°vel** via `store.SetHistorySyncConfig()`

## üì¶ Instala√ß√£o

```bash
go get github.com/SEU-USUARIO/whatsmeow@v1.0.0
```

Ou usando replace no go.mod:

```go
replace go.mau.fi/whatsmeow => github.com/SEU-USUARIO/whatsmeow v1.0.0
```

## üöÄ Uso

```go
import "github.com/SEU-USUARIO/whatsmeow"

// Usa automaticamente com hist√≥rico desabilitado
client := whatsmeow.NewClient(device, nil)
```

## üìö Documenta√ß√£o

Ver arquivos:
- [LEIA-ME_MODIFICACAO.txt](LEIA-ME_MODIFICACAO.txt)
- [RESUMO_SOLUCAO.md](RESUMO_SOLUCAO.md)
```

### 4. Divulgar

- **GitHub Discussions**: https://github.com/tulir/whatsmeow/discussions
- **Matrix Room**: #whatsmeow:maunium.net
- **README**: Adicionar badge "Fork with no history sync"

---

## ‚ùì FAQ - Publica√ß√£o

### Preciso de permiss√£o para criar fork?

**N√£o!** Forks s√£o permitidos e encorajados no GitHub, desde que voc√™ mantenha
a licen√ßa original (MPL 2.0 no caso do WhatsMeow).

### Posso cobrar pela modifica√ß√£o?

**Sim**, mas voc√™ deve manter o c√≥digo open-source conforme a licen√ßa MPL 2.0.

### Como manter meu fork atualizado?

```bash
# Adicionar upstream original
git remote add upstream https://github.com/tulir/whatsmeow.git

# Buscar atualiza√ß√µes
git fetch upstream

# Merge das atualiza√ß√µes
git merge upstream/main

# Resolver conflitos se houver
# ...

# Push
git push origin main
```

### E se o maintainer rejeitar meu PR?

N√£o tem problema! Mantenha seu fork e continue disponibilizando para quem
precisar. Muitos projetos bem-sucedidos come√ßaram como forks.

---

## üéâ Conclus√£o

**Recomenda√ß√£o:**

1. ‚úÖ **Criar fork no GitHub** (disponibiliza√ß√£o imediata)
2. ‚úÖ **Criar Pull Request** (tentativa de integra√ß√£o oficial)
3. ‚úÖ **Divulgar na comunidade** (ajudar outros usu√°rios)

Dessa forma voc√™:
- Disponibiliza sua solu√ß√£o imediatamente
- Tenta melhorar o projeto original
- Ajuda a comunidade

Boa sorte! üöÄ
